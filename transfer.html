<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run Management with Barcode Scanner</title>
<style>
body{
    font-family: 'Segoe UI', sans-serif;
    background: #f4f6f9;
    margin: 0;
    padding: 20px;
    text-align: center;
}
.header{
    background: #1f2937;
    color: white;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    padding: 18px;
    border-radius: 8px;
}
.menu-section, .table-section, .scan-section{
    margin-top: 20px;
}
.menu-card{
    background:white;
    padding:20px;
    margin-bottom:12px;
    border-radius:12px;
    text-align:center;
    font-size:18px;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
}
.menu-card:hover{
    transform:translateY(-3px);
}
.icon{
    font-size:30px;
    margin-bottom:10px;
    display:block;
}
table{
    width:100%;
    border-collapse: collapse;
    background:white;
    border-radius: 10px;
    overflow:hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
th, td{
    padding:12px;
    border-bottom:1px solid #eee;
    font-size:14px;
    text-align:left;
}
th{
    background:#1f2937;
    color:white;
}
button{
    padding:6px 12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:13px;
    margin-right: 5px;
}
.primary{
    background:#2563eb;
    color:white;
}
.success{
    background:#16a34a;
    color:white;
}
.back-btn{
    background:#ef4444;
    color:white;
}
.hidden{
    display:none;
}
#scanner-container{
    width:100%;
    max-width:400px;
    margin:auto;
}
video{
    width:100%;
    border:1px solid #ccc;
    border-radius:8px;
}
#result{
    margin-top:10px;
    font-size:1.1em;
    color:green;
}
</style>
</head>
<body>

<div class="header">Run Management Flow</div>

<!-- MENU -->
<button class="back-btn" onclick="location.href='run-management.html'">â¬… Back</button>

<div class="menu-section">
    <div class="menu-card" onclick="showRun('send')">
        <span class="icon">ðŸ“¤</span>Send
    </div>
    <div class="menu-card" onclick="showRun('receive')">
        <span class="icon">ðŸ“¥</span>Receive
    </div>
</div>

<!-- RUN LIST -->
<div class="table-section hidden" id="runSection">
    <button class="back-btn" onclick="backToMenu()">Back</button>
    <h2 id="runTitle"></h2>
    <table>
        <tr>
            <th>Run ID</th>
            <th>Run Type</th>
            <th>To Hub</th>
            <th>VDA Name</th>
            <th>Route</th>
            <th>Run Status</th>
            <th>Action</th>
        </tr>
        <tr>
            <td>447392</td>
            <td id="runType"></td>
            <td>Central Sort</td>
            <td>Modhu Bhai</td>
            <td>-</td>
            <td>Starting</td>
            <td id="runAction"></td>
        </tr>
    </table>
</div>

<!-- BASKET LIST -->
<div class="table-section hidden" id="basketSection">
    <button class="back-btn" onclick="backToRun()">Back</button>
    <h2>Basket List</h2>
    <table>
        <tr>
            <th>Basket ID</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        <tr>
            <td>BOX-001</td>
            <td>Received</td>
            <td><button class="success" onclick="openScan()">Open</button></td>
        </tr>
    </table>
</div>

<!-- SCAN SECTION -->
<div class="scan-section hidden" id="scanSection">
    <button class="back-btn" onclick="backToBasket()">Back</button>
    <h2>Scan Consignment</h2>
    <div id="scanner-container">
        <video id="barcode-scanner" autoplay></video>
    </div>
    <div id="result">Total Count: <span id="count">0</span></div>
    <button class="success" onclick="completeReceive()">Receive</button>
</div>

<!-- Include QuaggaJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
let count = 0;
let currentRunType = '';
let scannedCodes = new Set();

// Show run list
function showRun(type){
    currentRunType = type;
    document.querySelector('.menu-section').classList.add('hidden');
    document.getElementById('runSection').classList.remove('hidden');

    if(type === 'send'){
        document.getElementById('runTitle').innerText = 'Send Run List';
        document.getElementById('runType').innerText = 'Transfer';
        document.getElementById('runAction').innerHTML =
            '<button class="primary">Gate Pass Print</button>';
    } else {
        document.getElementById('runTitle').innerText = 'Receive Run List';
        document.getElementById('runType').innerText = 'Receive';
        document.getElementById('runAction').innerHTML =
            '<button class="primary" onclick="viewBasket()">View</button>';
    }
}

function backToMenu(){
    document.getElementById('runSection').classList.add('hidden');
    document.querySelector('.menu-section').classList.remove('hidden');
}

function viewBasket(){
    document.getElementById('runSection').classList.add('hidden');
    document.getElementById('basketSection').classList.remove('hidden');
}

function backToRun(){
    document.getElementById('basketSection').classList.add('hidden');
    document.getElementById('runSection').classList.remove('hidden');
}

function openScan(){
    document.getElementById('basketSection').classList.add('hidden');
    document.getElementById('scanSection').classList.remove('hidden');
    startScanner();
}

function backToBasket(){
    stopScanner();
    document.getElementById('scanSection').classList.add('hidden');
    document.getElementById('basketSection').classList.remove('hidden');
}

// Barcode Scanner
function startScanner(){
    scannedCodes.clear();
    count = 0;
    document.getElementById('count').innerText = count;

    Quagga.init({
        inputStream: {
            name: "Live",
            type: "LiveStream",
            target: document.querySelector('#barcode-scanner'),
            constraints: { facingMode: "environment" }
        },
        decoder: {
            readers: ["code_128_reader", "ean_reader", "ean_8_reader", "upc_reader", "upc_e_reader"]
        }
    }, function(err){
        if(err){
            console.error(err);
            alert("Error initializing scanner");
            return;
        }
        Quagga.start();
    });

    Quagga.onDetected(onBarcodeDetected);
}

function stopScanner(){
    Quagga.stop();
    Quagga.offDetected(onBarcodeDetected);
}

function onBarcodeDetected(result){
    const code = result.codeResult.code;
    if(!scannedCodes.has(code)){
        scannedCodes.add(code);
        count++;
        document.getElementById('count').innerText = count;
        console.log("Scanned:", code);
    }
}

// Complete receive
function completeReceive(){
    stopScanner();
    alert('Receive completed! Total scanned items: ' + count);
    count = 0;
    document.getElementById('count').innerText = 0;
    backToMenu();
}
</script>
</body>
</html>
